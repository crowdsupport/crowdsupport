<div class="container-fluid place">
    <div class="row">
        <nav class="navbar">
            <p class="navbar-text">{{place.name}} @ {{place.location}}
                ({{place.city.name}})
            </p>

            <div class="navbar-right options">
                <div class="btn-group filtertoggle">
                    <label class="btn btn-default" ng-model="f.open" uib-btn-checkbox>Donations needed</label>
                    <label class="btn btn-warning" ng-model="f.enroute" uib-btn-checkbox>Enough en route</label>
                    <label class="btn btn-success" ng-model="f.done" uib-btn-checkbox>Done</label>
                </div>
                <span class="orga" ng-if="inTeam()">
                    <a href="/support/{{place.city.state.identifier}}/{{place.city.identifier}}/{{place.identifier}}/manage"><span
                            uib-tooltip="Manage place" class="btn glyphicon glyphicon-wrench"></span></a>
                    <a href="" ng-click="addRequest()"><span uib-tooltip="Add request" tooltip-append-to-body="true"
                                                             class="btn glyphicon glyphicon-plus"></span></a>
                </span>
            </div>
        </nav>
    </div>

    <div class="row" id="donationrequests" ng-controller="DonationRequestsCtrl">
        <div ng-repeat="req in donationRequests | filter : filter : true | orderBy : order" ng-class="req.ui.state"
             class="request col-lg-3 col-md-4 col-sm-6 col-xs-12 animate-repeat">
            <div class="panel panel-default panel-body">
                <div class="age">
                    <span ng-if="inTeam()">
                        <button class="btn btn-sm" uib-tooltip="Delete request" tooltip-append-to-body="true"><span
                                class="glyphicon glyphicon-remove"></span></button>
                        <button class="btn btn-sm" uib-tooltip="Mark request as resolved" tooltip-append-to-body="true"><span
                                class="glyphicon glyphicon-ok"></span></button>
                        <br/>
                    </span>
                    <time class="time-ago" datetime="{{req.createdDateTime}}"
                          uib-tooltip="{{req.createdDateTime | time}}" tooltip-append-to-body="true">
                        {{req.createdDateTime | time}}
                    </time>
                </div>


                <h3>{{req.title}}</h3>
                <p>{{req.description}}</p>

                <div ng-if="req.quantity">
                    <div class="justified-and-inlined">
                        <div>Need</div>
                        <div uib-tooltip-template="'tooltip.html'">
                            {{req.ui.quantityLeft | posNum}} {{req.unit}} <span
                                ng-show="req.ui.quantityLeft != req.quantity">(of {{req.quantity}})</span>
                        </div>
                    </div>

                    <uib-progress>
                        <uib-bar value="req.ui.pConfirmed" type="success" class="progress-striped"
                                 uib-tooltip="Confirmed">
                            <span ng-hide="req.ui.pConfirmed < 20">{{req.ui.confirmed}}</span>
                        </uib-bar>
                        <uib-bar value="req.ui.pPromised" type="warning" class="progress-striped"
                                 uib-tooltip="En route">
                            <span ng-hide="req.ui.pPromised < 20">{{req.ui.promised}}</span>
                        </uib-bar>
                    </uib-progress>
                </div>

                <div class="tags">
                    <span ng-repeat="tag in req.tags">{{tag}} <span ng-if="!$last">| </span></span>
                </div>

                <div class="justified-and-inlined" ng-if="req.validToDateTime">
                    <div>Expires</div>
                    <div>{{req.validToDateTime}}</div>
                </div>

                <div class="comments" ng-show="req.comments">
                    <div ng-repeat="comment in req.comments" class="panel panel-default panel-body">
                        <div class="media">
                            <div class="media-left">
                                <div class="pic"></div>
                            </div>
                            <div class="media-body">
                                <b>{{comment.author.username}}</b>: {{comment.text}}

                                <p class="pull-right" ng-if="comment.quantity > 0">{{comment.quantity}} {{req.unit}}</p>
                            </div>
                        </div>
                        <div ng-if="inTeam()" class="pull-right">
                            <button class="btn btn-xs" uib-tooltip="Delete comment" tooltip-append-to-body="true"><span
                                    class="glyphicon glyphicon-remove"></span></button>
                            <button class="btn btn-xs" uib-tooltip="Confirm donation" tooltip-append-to-body="true">
                                <span class="glyphicon glyphicon-ok"></span></button>
                        </div>
                    </div>
                </div>

                <div class="well" ng-show="$root.user && req.active">
                    <form ng-submit="req.ui.sendComment()" name="commentForm">
                        <div class="media">
                            <div class="media-left">
                                <div class="pic"></div>
                            </div>
                            <div class="media-body">
                                <b class="media-heading">{{$root.user.username}}</b>
                                <textarea class="form-control" placeholder="New comment..."
                                          ng-model="req.ui.commentText"></textarea>
                                <input class="form-control" type="number" placeholder="Qty"
                                       ng-model="req.ui.commentQuantity" ng-show="req.quantity"/>

                                <button class="pull-right btn btn-default"
                                        ng-disabled="req.ui.commentText.length === 0">Send
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/ng-template" id="tooltip.html">
    <span>
        Confirmed: {{req.ui.confirmed}}<br/>
        En route: {{req.ui.promised}}
    </span>
</script>